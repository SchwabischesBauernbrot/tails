[[!meta date="Tue, 14 Jun 2023 12:34:56 -0000"]]
[[!meta title="Weak cryptographic parameters in LUKS1"]]
[[!pagetemplate template="news.tmpl"]]

[[!tag security/fixed]]

The cryptographic parameters of LUKS from Tails 5.12 or earlier are weak
against state-sponsored attackers with physical access to your device.

We recommend you change the passphrase of your Persistent Storage and other
[[encrypted volumes|doc/encryption_and_privacy/encrypted_volumes]] unless you
use a long passphrase of 5 or more random words.

[[!toc levels=2]]

<h1 id="understanding">Understanding the weakness and its solution</h1>

<h2 id="race">The arms race to protect from brute-force attacks</h2>

In all encryption technology that protect data on a disk or USB stick with a
password or a passphrase, an attacker can try all possible combinations until
they guess your passphrase and unlock the encryption. This type of attack is
called a *[[!wikipedia brute-force attack]]*.

A strong password makes brute-force attacks slower and more expensive. The
longer the passphrase, the more expensive the brute-force attack becomes.

Some cryptographic parameters can also make each guess of a brute-force attack
slower and more expensive, for example by having to some complicated
calculations on each passphrase before being able to try to unlock the
encryption with the result of this calculation.

Over the years, computers become faster and cheaper. Encryption technologies
regularly update their parameters to find a balance between making encryption
fast and usable by users while making brute-force attacks as expensive as
possible for attackers.

Strong encryption parameters *combined* with a strong passphrase make
brute-force attacks so slow and so expensive that they are impossible to do in
practice. For example, a brute-force attack is impossible to do in practice if
would take thousands of years even with the most powerful supercomputers.

<h2 id="comparison">Strength of Argon2id compared to PBKDF2</h2>

Until Tails 5.12 (April 2023), Tails created LUKS devices version 1 (LUKS1)
with PBKDF2 as *key derivation function*, a calculation run on the passphrase
before trying to unlock the encryption with the result.

PBKDF2 is now considered too weak compared to available computing power.

Some cryptographers think this weakness might have already been [used against
activists in France](https://mjg59.dreamwidth.org/66429.html) but the actual
operations by the French police are kept secret.

Since Tails 5.13 (May 2023), Tails creates LUKS devices version 2 (LUKS2) with
Argon2id as *key derivation function*.

Our team estimated that Argon2id make brute-force attacks 2 million times
slower and 600 million times more expensive to perform than with PBKDF2.

For example, after you upgrade to LUKS2 and Argon2id, you might notice that
creating and unlocking the Persistent Storage is slower.

<table>
<tr><th>Tails version<br/>when encryption was created</th><th>Release date</th><th>LUKS version</th><th>Key derivation function</th><th>Strength</th></tr>
<tr><td>5.12 or earlier</td><td>19 April 2023</td><td>LUKS1</td><td>PBKDF2</td><td>Weak</td></tr>
<tr><td>5.13 or later</td><td>16 May 2023</td><td>LUKS2</td><td>Argon2id</td><td>Strong</td></tr>
</table>

We estimated how much electricity it would cost to guess different strengths of
passphrase. As we recommend for the Persistent Storage, we evaluated
passphrases made of several randoms words.

<table>
<tr><th>Passphrase length</th><th>PBKDF2</th><th>Argon2id</th></tr>
<tr><td>3 random words</td><td>$0.01</td><td>$10&#8239;000&#8239;000</td></tr>
<tr><td>4 random words</td><td>$100</td><td>$100&#8239;000&#8239;000&#8239;000</td></tr>
<tr><td>5 random words</td><td>$1&#8239;000&#8239;000</td><td>$1&#8239;000&#8239;000&#8239;000&#8239;000&#8239;000</td></tr>
<tr><td>6 random words</td><td>$10&#8239;000&#8239;000&#8239;000</td><td>$10&#8239;000&#8239;000&#8239;000&#8239;000&#8239;000&#8239;000</td></tr>
<tr><td>7 random words</td><td>$100&#8239;000&#8239;000&#8239;000&#8239;000</td><td>$10&#8239;000&#8239;000&#8239;000&#8239;000&#8239;000&#8239;000&#8239;000</td></tr>
</table>

These numbers are very rough estimate but give an idea of what length of
passphrase a very powerful adversary, like a state-sponsored attacker could
guess.

Even if guessing a passphrase of 3 random words with LUKS1 costs very little
energy, any such attack also requires:

- Physical access to the devices
- Very expensive computer equipment
- Professional hacking skills

You can see the details of our calculations in this spreadsheet. XXX

<h2 id="schemes">Other password schemes give too little guarantee</h2>

At Tails, we recommend using passphrases made of several random words because
using randomness is the only way to really guarantee the strength of a
password.

Using other password schemes give little guarantee over the strength of a
password, even if it follows complicated password policies and validates on
password strength meters.

For example, a [Dutch hacker logged into Donald Trump's Twitter account
*twice*](https://www.washingtonpost.com/world/2020/12/17/dutch-trump-twitter-password-hack/)
by guessing his password, despite the passwords including several words, being
more than 8 characters, and even having special characters. They were
definitely not random enough: "*maga2020!*" and "*yourefired*".

To understand the maths behind password strength, watch [An information
theoretic model of privacy and security
metrics](https://media.libreplanet.org/u/libreplanet/m/an-information-theoretic-model-of-privacy-and-security-metrics/).
Bill Budington from the EFF explains the concept of entropy and its implication
on browser fingerprinting and password safety in accessible terms.

<h1 id="updating">Keeping your encryption secure</h1>

All users are recommended to upgrade to LUKS2 on all their encrypted devices:
Persistent Storage, backup Tails, and other external encrypted volumes.

Depending on the strength of your passphrase, we might also recommend choosing
a different passphrase and migrating to another Tails USB stick:

- [[If your passphrase has 4 random words or less|argon2id#4]]
- [[If your passphrase has 5 random words|argon2id#5]]
- [[If your passphrase has 6 random words or more|argon2id#6]]

<h2 id="4">If your passphrase has 4 random words or less</h2>

If your current passphrase has 4 random words or less:

- Your encryption is insecure with LUKS1.

- Your encryption is more secure with LUKS2.

  We still recommend changing your passphrase to be 5 random words or more.

### Persistent Storage (4 words or less)

To secure your Persistent Storage:

1. Update to Tails 5.14.

   When starting Tails 5.14 for the first time, Tails will convert
   automatically your Persistent Storage to LUKS2.

1. Choose a new passphrase of 5 to 7 random words.

   [[!toggle id="4_ps_keepassxc" text="Display the instructions to generate a passphrase using *KeePassXC*."]]
   [[!toggleable id="4_ps_keepassxc" text="""
   [[!inline pages="security/argon2id/keepassxc.inline" raw="yes" sort="age"]]
   """]]

1. Change your passphrase.

   [[!toggle id="4_ps_passphrase" text="Display the instructions to change the passphrase of your Persistent Storage."]]
   [[!toggleable id="4_ps_passphrase" text="""
   [[!inline pages="security/argon2id/ps_passphrase.inline" raw="yes" sort="age"]]
   """]]

1. If you created your Persistent Storage with Tails 5.12 or earlier, we
   recommend you migrate your entire Tails to a different USB stick and destroy
   your old Tails USB stick (or at least [[securely delete the entire
   device|doc/encryption_and_privacy/secure_deletion#device]]).

   If you don't, the previous LUKS1 data might still be written in some recovery
   data on the USB stick and could be recovered using advanced data forensics
   techniques.

   [[!toggle id="4_ps_tails_installer" text="Display the instructions to migrate your Tails to a new USB stick."]]
   [[!toggleable id="4_ps_tails_installer" text="""
   [[!inline pages="security/argon2id/tails_installer.inline" raw="yes" sort="age"]]
   """]]

### Backup Tails (4 words or less)

To secure your [[backup Tails|doc/persistent_storage/backup]], if you have one:

1. Start on your main Tails USB stick.

1. Update your main Tails USB stick to Tails 5.14.

1. Create a new backup Tails using *Tails Installer*

   If you created your Persistent Storage with Tails 5.12 or earlier, we
   recommend you create your new backup Tails on a different USB stick and
   destroy your old backup Tails (or at least [[securely delete the entire
   device|doc/encryption_and_privacy/secure_deletion#device]]).

   If you don't, the previous LUKS1 data might still be written in some recovery
   data on the USB stick and could be recovered using advanced data forensics
   techniques.

   [[!toggle id="4_backup_tails_installer" text="Display the instructions to create a new backup."]]
   [[!toggleable id="4_backup_tails_installer" text="""
   [[!inline pages="security/argon2id/tails_installer.inline" raw="yes" sort="age"]]
   """]]

### Other encrypted volumes (4 words or less)

To secure your other encrypted volumes, if you have any:

1. Update to Tails 5.14.

1. Choose a new passphrase of 5 to 7 random words.

   [[!toggle id="4_other_keepassxc" text="Display the instructions to generate a passphrase using *KeePassXC*."]]
   [[!toggleable id="4_other_keepassxc" text="""
   [[!inline pages="security/argon2id/keepassxc.inline" raw="yes" sort="age"]]
   """]]

If your encrypted volume is on a traditional hard disk (not an SSD) and you can
use the command line:

1. Identify the partition name of your encrypted volume.

   [[!toggle id="4_other_cryptsetup_partition" text="Display the instructions to identify the partition name using the command line."]]
   [[!toggleable id="4_other_cryptsetup_partition" text="""
   [[!inline pages="security/argon2id/cryptsetup_partition.inline" raw="yes" sort="age"]]
   """]]

1. If you created your encrypted volume with Tails 5.12 or earlier, upgrade to
   LUKS2.

   [[!toggle id="4_other_cryptsetup_upgrade" text="Display the instructions to upgrade to LUKS2 using the command line."]]
   [[!toggleable id="4_other_cryptsetup_upgrade" text="""
   [[!inline pages="security/argon2id/cryptsetup_upgrade.inline" raw="yes" sort="age"]]
   """]]

1. Change your passphrase.

   [[!toggle id="4_other_cryptsetup_passphrase" text="Display the instructions to change your passphrase using the command line."]]
   [[!toggleable id="4_other_cryptsetup_passphrase" text="""
   [[!inline pages="security/argon2id/cryptsetup_passphrase.inline" raw="yes" sort="age"]]
   """]]

Otherwise, if your encrypted volume is on a USB stick (or an SSD) or you are
not comfortable with the command line:

- If you created your encrypted volume with Tails 5.13 or later, we recommend
  you change your passphrase.

  Follow our instructions on [[changing the passphrase of an existing encrypted
  partition|doc/encryption_and_privacy/encrypted_volumes#changing]].

- If you created your encrypted volume with Tails 5.12 or earlier, we recommend
  you migrate all your encrypted data to a new encrypted device.

  Follow our instructions on [[creating and using LUKS encrypted
  volumes|doc/encryption_and_privacy/encrypted_volumes]].

  We also recommend you destroy your old device (or at least [[securely delete
  the entire device|doc/encryption_and_privacy/secure_deletion#device]]).

  If you don't, the previous LUKS1 data might still be written in some recovery
  data on the USB stick and could be recovered using advanced data forensics
  techniques.

<h2 id="5">If your passphrase has 5 random words</h2>

If your current passphrase has 5 random words:

- Your encryption is secure with LUKS1, except against a very powerful
  adversary, like a state-sponsored attacker with a huge budget to spend on
  guessing your passphrase.

  We still recommend you upgrade to LUKS2.

- Your encryption is even more secure with LUKS2.

Congratulations for following our recommendations!

### Persistent Storage (5 words)

To secure your Persistent Storage:

1. Update to Tails 5.14.

   When starting Tails 5.14 for the first time, Tails will convert
   automatically your Persistent Storage to LUKS2.

1. Consider adding another random word to your passphrase.

   [[!toggle id="5_ps_passphrase" text="Display the instructions to change the passphrase of your Persistent Storage."]]
   [[!toggleable id="5_ps_passphrase" text="""
   [[!inline pages="security/argon2id/ps_passphrase.inline" raw="yes" sort="age"]]
   """]]

1. If you created your encrypted volume with Tails 5.12 or earlier and are
   worried about a very powerful adversary, consider migrating your entire
   Tails to a different USB stick and destroying your old Tails USB stick (or
   at least [[securely deleting the entire
   device|doc/encryption_and_privacy/secure_deletion#device]]).

   If you don't, the previous LUKS1 data might still be written in some recovery
   data on the USB stick and could be recovered using advanced data forensics
   techniques.

   [[!toggle id="5_ps_tails_installer" text="Display the instructions to migrate your entire Tails to a new USB stick."]]
   [[!toggleable id="5_ps_tails_installer" text="""
   [[!inline pages="security/argon2id/tails_installer.inline" raw="yes" sort="age"]]
   """]]

### Backup Tails (5 words)

To secure your [[backup Tails|doc/persistent_storage/backup]], if you have one:

1. Start on your main Tails USB stick.

1. Update your main Tails USB stick to Tails 5.14.

1. Update your backup or create a new backup Tails using *Tails Installer*.

   If you created your backup Tails with Tails 5.12 or earlier and are worried
   about a very powerful adversay, consider creating your new backup Tails on a
   different USB stick and destroying your old backup Tails (or at least
   [[securely deleting the entire
   device|doc/encryption_and_privacy/secure_deletion#device]]).

   If you don't, the previous LUKS1 data might still be written in some recovery
   data on the USB stick and could be recovered using advanced data forensics
   techniques.

   [[!toggle id="5_backup_tails_installer" text="Display the instructions to update your backup or create a new backup."]]
   [[!toggleable id="5_backup_tails_installer" text="""
   [[!inline pages="security/argon2id/tails_installer.inline" raw="yes" sort="age"]]
   """]]

### Other encrypted volumes (5 words)

To secure your other encrypted volumes, if you have any:

1. Update to Tails 5.14.

1. Consider adding another random word to your passphrase.

If you created your encrypted volume with Tails 5.12 or earlier and your
encrypted volume is on a traditional hard disk (not an SSD) and you can use
the command line:

1. Identify the partition name of your encrypted volume.

   [[!toggle id="5_other_cryptsetup_partition" text="Display the instructions to identify the partition name using the command line."]]
   [[!toggleable id="5_other_cryptsetup_partition" text="""
   [[!inline pages="security/argon2id/cryptsetup_partition.inline" raw="yes" sort="age"]]
   """]]

1. If you created your encrypted volume with Tails 5.12 or earlier, upgrade to
   LUKS2.

   [[!toggle id="5_other_cryptsetup_upgrade" text="Display the instructions to upgrade to LUKS2 using the command line."]]
   [[!toggleable id="5_other_cryptsetup_upgrade" text="""
   [[!inline pages="security/argon2id/cryptsetup_upgrade.inline" raw="yes" sort="age"]]
   """]]

1. Change your passphrase.

   [[!toggle id="5_other_cryptsetup_passphrase" text="Display the instructions to change your passphrase using the command line."]]
   [[!toggleable id="5_other_cryptsetup_passphrase" text="""
   [[!inline pages="security/argon2id/cryptsetup_passphrase.inline" raw="yes" sort="age"]]
   """]]

If you create your encrypted volume with Tails 5.12 or earlier and your
encrypted volume is on a USB stick (or an SSD) or if you are not comfortable
with the command line:

1. Migrate all your encrypted data to a new encrypted device.

   Follow our instructions on [[creating and using LUKS encrypted
   volumes|doc/encryption_and_privacy/encrypted_volumes]].

1. If you are worried about a very powerful adversay, consider destroying your
   old device (or at least [[securely deleting the entire
   device|doc/encryption_and_privacy/secure_deletion#device]]).

   If you don't, the previous LUKS1 data might still be written in some recovery
   data on the USB stick and could be recovered using advanced data forensics
   techniques.

<h2 id="6">If your passphrase has 6 random words or more</h2>

If your current passphrase has 6 random words or more:

- Your encryption is secure with LUKS1, even against a very powerful adversary.

  We still recommend you upgrade to LUKS2.

- Your encryption is even more secure with LUKS2.

Congratulations for following our most secure recommendations!

### Persistent Storage (6 words or more)

To secure your Persistent Storage:

1. Update to Tails 5.14.

   When starting Tails 5.14 for the first time, Tails will convert
   automatically your Persistent Storage to LUKS2.

### Backup Tails (6 words or more)

To secure your [[backup Tails|doc/persistent_storage/backup]], if you have one:

1. Start on your main Tails USB stick.

1. Update your main Tails USB stick to Tails 5.14.

1. Update your backup using *Tails Installer*.

   [[!toggle id="6_backup_tails_installer" text="Display the instructions to update your backup."]]
   [[!toggleable id="6_backup_tails_installer" text="""
   [[!inline pages="security/argon2id/tails_installer.inline" raw="yes" sort="age"]]
   """]]

### Other encrypted volumes (6 words or more)

To secure your other encrypted volumes, if you have any that were created with
Tails 5.12 or earlier:

1. Update to Tails 5.14.

If you can use the command line:

1. Identify the partition name of your encrypted volume.

   [[!toggle id="5_other_cryptsetup_partition" text="Display the instructions to identify the partition name using the command line."]]
   [[!toggleable id="5_other_cryptsetup_partition" text="""
   [[!inline pages="security/argon2id/cryptsetup_partition.inline" raw="yes" sort="age"]]
   """]]

1. Upgrade to LUKS2.

   [[!toggle id="5_other_cryptsetup_upgrade" text="Display the instructions to upgrade to LUKS2 using the command line."]]
   [[!toggleable id="5_other_cryptsetup_upgrade" text="""
   [[!inline pages="security/argon2id/cryptsetup_upgrade.inline" raw="yes" sort="age"]]
   """]]

If you are not comfortable with the command line:

1. Migrate all your encrypted data to a new encrypted device.

   Follow our instructions on [[creating and using LUKS encrypted
   volumes|doc/encryption_and_privacy/encrypted_volumes]].

<h2 id="checking">Knowing which version of LUKS is used in your devices</h2>

If you can use the command line, you can verify whether your encryption uses
PBKDF2 or Argon2id.

###  Persistent Storage

   1. When starting Tails, [[set up an administration
      password|doc/first_steps/welcome_screen/administration_password/]].

   1. Choose **Applications**&nbsp;▸ **System Tools**&nbsp;▸ **Root Terminal**.

   1. To verify whether your encrypted volume uses PBKDF2 or Argon2id, execute
      the following command.

      <p class="pre command">sudo cryptsetup luksDump /dev/sda2</p>

      In the output:

      - <span class="command">Version</span> indicates the version of LUKS,
        either <span class="command">1</span> or <span class="command">2</span>.

      - <span class="command">PBKDF</span> indicates the key derivation function,
        either <span class="command">pbkdf2</span> or <span class="command">argon2id</span>.

### Other encrypted volumes

   [[!inline pages="security/argon2id/cryptsetup_partition.inline" raw="yes" sort="age"]]
   1. To verify whether your encrypted volume uses PBKDF2 or Argon2id, execute
      the following command.

      Replace <span class="command-placeholder">[partition]</span> with the
      partition name found in step 6.

      <p class="pre command">sudo cryptsetup luksDump /dev/<span class="command-placeholder">[partition]</span></p>

      In the output:

      - <span class="command">Version</span> indicates the version of LUKS,
        either <span class="command">1</span> or <span class="command">2</span>.

      - <span class="command">PBKDF</span> indicates the key derivation function,
        either <span class="command">pbkdf2</span> or <span class="command">argon2id</span>.
